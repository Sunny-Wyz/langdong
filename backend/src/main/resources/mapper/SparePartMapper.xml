<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.langdong.spare.mapper.SparePartMapper">

    <resultMap id="SparePartResultMap" type="com.langdong.spare.entity.SparePart">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="model" column="model"/>
        <result property="quantity" column="quantity"/>
        <result property="unit" column="unit"/>
        <result property="price" column="price"/>
        <result property="category" column="category"/>
        <result property="supplier" column="supplier"/>
        <result property="remark" column="remark"/>
        <result property="locationId" column="location_id"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>

    <select id="findAll" resultMap="SparePartResultMap">
        SELECT id, name, model, quantity, unit, price, category, supplier, remark, location_id, created_at, updated_at
        FROM spare_part
        ORDER BY created_at DESC
    </select>

    <select id="findById" resultMap="SparePartResultMap">
        SELECT id, name, model, quantity, unit, price, category, supplier, remark, location_id, created_at, updated_at
        FROM spare_part
        WHERE id = #{id}
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO spare_part (name, model, quantity, unit, price, category, supplier, remark, location_id)
        VALUES (#{name}, #{model}, #{quantity}, #{unit}, #{price}, #{category}, #{supplier}, #{remark}, #{locationId})
    </insert>

    <update id="update">
        UPDATE spare_part
        <set>
            <if test="name != null and name != ''">name = #{name},</if>
            <if test="model != null">model = #{model},</if>
            <if test="quantity != null">quantity = #{quantity},</if>
            <if test="unit != null">unit = #{unit},</if>
            <if test="price != null">price = #{price},</if>
            <if test="category != null">category = #{category},</if>
            <if test="supplier != null">supplier = #{supplier},</if>
            <if test="remark != null">remark = #{remark},</if>
            <if test="locationId != null">location_id = #{locationId},</if>
        </set>
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM spare_part WHERE id = #{id}
    </delete>

    <select id="findByEquipmentId" resultMap="SparePartResultMap">
        SELECT sp.id, sp.name, sp.model, sp.quantity, sp.unit, sp.price, sp.category, sp.supplier, sp.remark, sp.location_id, sp.created_at, sp.updated_at
        FROM spare_part sp
        INNER JOIN equipment_spare_part esp ON sp.id = esp.spare_part_id
        WHERE esp.equipment_id = #{equipmentId}
        ORDER BY esp.created_at DESC
    </select>

</mapper>
